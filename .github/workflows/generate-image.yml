name: 급등이슈 이미지 생성

on:
  workflow_dispatch:  # 수동 실행 버튼

jobs:
  generate:
    runs-on: ubuntu-latest
    
    steps:
    - name: 코드 체크아웃
      uses: actions/checkout@v4
    
    - name: Python 설정
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: 라이브러리 설치
      run: |
        pip install -r requirements.txt
        python -m playwright install chromium
        python -m playwright install-deps
    
    - name: 서비스 계정 키 설정
      env:
        SERVICE_ACCOUNT_KEY: ${{ secrets.SERVICE_ACCOUNT_KEY }}
      run: |
        echo "$SERVICE_ACCOUNT_KEY" > service_account.json.json
    
    - name: 이미지 생성 실행
      run: python main.py
    
    - name: 생성된 이미지 업로드
      uses: actions/upload-artifact@v4
      with:
        name: 급등이슈-이미지-${{ github.run_number }}
        path: output/*.png
        retention-days: 30

